<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlertUnity - Wind Flow Tracker</title>
    <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico">
    
    
    <link rel="stylesheet" href="https://js.arcgis.com/4.34/esri/themes/dark/main.css">

    <link rel="stylesheet" href="../../styles/global.css">
    <link rel="stylesheet" href="../../styles/landing.css">
    <link rel="stylesheet" href="../../styles/hurricane/hurricane-history.css">

    <script type="module" src="https://js.arcgis.com/calcite-components/3.3.3/calcite.esm.js"></script>
    <script src="https://js.arcgis.com/4.34/"></script>
    <script type="module" src="https://js.arcgis.com/4.34/map-components/"></script>

    <script type="module" src="../../script/current-user.js"></script>
    <script src="../../script/hurricane/hurricane.js"></script>
    
    <!-- Translation System -->
    <script src="../../script/i18n.js"></script>
</head>

<body class="calcite-mode-dark">
    <div id="container">
        <nav class="navbar" id="navbar">
            <div class="nav-container">
                <div class="logo-nav">
                    <div class="logo-icon-nav"><img src="../../assets/logo-small-white.png" class="logo-icon"></div>
                    <div class="logo-text">AlertUnity</div>
                </div>

                <ul class="nav-links">
                    <li><a href="../hurricane.html" data-i18n="nav.home">Home</a></li>
                    <li><a href="hurricane-report.html" data-i18n="nav.reportHurricane">Report</a></li>
                    <li><a href="map.html" data-i18n="nav.liveMap">Live Map</a></li>
                    <li><a href="hurricane-history.html" data-i18n="nav.history">History</a></li>
                    <li><a href="ocean-map.html" data-i18n="nav.oceanWinds">Ocean Winds</a></li>
                    <li><a href="#" class="active" data-i18n="nav.windMap">Wind Map</a></li>
                    <li><a href="../disasters/contact.html" data-i18n="nav.contact">Contact</a></li>
                </ul>

                <div class="nav-cta">
                    <a href="../disasters/sign-in.html" class="btn-nav btn-secondary" style="visibility: hidden;" data-i18n="nav.signIn">Sign In</a>
                    <a href="../disasters/sign-up.html" class="btn-nav btn-primary" style="visibility: hidden;" data-i18n="nav.joinNow">Join Now</a>
                </div>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                    <span class="theme-icon"><i class="fa-solid fa-moon"></i></span>
                </button>

                <button class="mobile-toggle">â˜°</button>
            </div>
        </nav>
        
        <arcgis-map center="-98, 39" zoom="4" id="viewDiv">
            <arcgis-zoom slot="top-left"></arcgis-zoom>
            <arcgis-expand slot="top-left">
                <arcgis-legend></arcgis-legend>
            </arcgis-expand>
            <arcgis-expand slot="top-right" expand-icon="sliders-horizontal">
                <calcite-card id="controls" class="calcite-mode-dark" style="width: 300px; max-height: 90vh; overflow: auto;">
                    <div slot="title" data-i18n="wind.windFlowControls">Wind Flow Controls</div>
                    <calcite-label>
                        <span data-i18n="ocean.trailWidth">Trail width</span>
                        <calcite-slider id="trailWidth" min="0.1" max="10" value="2" step="0.1" label-handles></calcite-slider>
                    </calcite-label>
                    <calcite-label>
                        <span data-i18n="ocean.trailLength">Trail length</span>
                        <calcite-slider id="trailLength" min="0.1" max="200" value="100" label-handles></calcite-slider>
                    </calcite-label>
                    <calcite-label>
                        <span data-i18n="ocean.density">Density</span>
                        <calcite-slider id="density" min="0.1" max="3" value="1" step="0.1" label-handles></calcite-slider>
                    </calcite-label>
                    <calcite-label>
                        <span data-i18n="ocean.flowSpeed">Flow speed</span>
                        <calcite-slider id="flowSpeed" min="0.1" max="40" value="10" step="0.1" label-handles></calcite-slider>
                    </calcite-label>
                    <calcite-label>
                        <span data-i18n="ocean.maxPathLength">Maximum path length</span>
                        <calcite-slider id="maxPathLength" min="0.1" max="300" value="200" label-handles></calcite-slider>
                    </calcite-label>
                    <calcite-label>
                        <span data-i18n="ocean.flowRepresentation">Flow representation</span>
                        <calcite-segmented-control id="flowRepresentation">
                            <calcite-segmented-control-item value="flow-to" data-i18n="ocean.to">To</calcite-segmented-control-item>
                            <calcite-segmented-control-item value="flow-from" checked data-i18n="ocean.from">From</calcite-segmented-control-item>
                        </calcite-segmented-control>
                    </calcite-label>
                    <calcite-label>
                        <span data-i18n="ocean.capStyle">Cap style</span>
                        <calcite-segmented-control id="trailCap">
                            <calcite-segmented-control-item value="butt" checked data-i18n="ocean.butt">Butt</calcite-segmented-control-item>
                            <calcite-segmented-control-item value="round" data-i18n="ocean.round">Round</calcite-segmented-control-item>
                        </calcite-segmented-control>
                        <small>*Round caps are only supported when trail width is greater than 3pt</small>
                    </calcite-label>
                    <calcite-label>
                        <span data-i18n="ocean.effectsEnabled">Effects enabled</span>
                        <calcite-checkbox id="effectsEnabled" checked></calcite-checkbox>
                    </calcite-label>
                </calcite-card>
            </arcgis-expand>
            
            <div class="info-panel" id="infoPanel">
                <h3 data-i18n="wind.windInfo">Wind Information</h3>
                <div class="info-item">
                    <div class="info-label" data-i18n="wind.dataSource">Data Source</div>
                    <div class="info-value" id="dataSource" data-i18n="wind.nldas">NLDAS Hourly</div>
                </div>
                <div class="info-item">
                    <div class="info-label" data-i18n="wind.date">Date</div>
                    <div class="info-value" id="dataDate">August 30, 2021</div>
                </div>
                <div class="info-item">
                    <div class="info-label" data-i18n="wind.visualization">Visualization</div>
                    <div class="info-value" id="vizType" data-i18n="wind.flowRenderer">Flow Renderer</div>
                </div>
            </div>
        </arcgis-map>
    </div>

    <script type="module">
        const [Map, ImageryTileLayer] = await $arcgis.import([
            "@arcgis/core/Map.js",
            "@arcgis/core/layers/ImageryTileLayer.js",
        ]);
        
        const viewElement = document.querySelector("arcgis-map");
        
        const layer = new ImageryTileLayer({
            url: "https://tiledimageservices.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/NLDAS_Hourly_8_30_2021/ImageServer",
            title: "Winds",
            renderer: {
                type: "flow",
                trailWidth: "2px",
                density: 1,
                visualVariables: [
                    {
                        type: "color",
                        field: "Magnitude",
                        stops: [
                            { color: [40, 146, 199, 1], value: 0 },
                            { color: [160, 194, 155, 1], value: 5 },
                            { color: [218, 230, 119, 1], value: 10 }
                        ]
                    }
                ]
            },
            effect: "bloom(1.5, 0.5px, 0)"
        });
        
        const map = new Map({
            basemap: "dark-gray-vector",
            layers: [layer]
        });
        
        viewElement.map = map;

        // Setup event listeners
        const sliderProps = ["trailWidth", "density", "maxPathLength", "flowSpeed", "trailLength"];
        sliderProps.forEach((prop) => {
            document.getElementById(prop).addEventListener("calciteSliderChange", updateRenderer);
        });
        
        document.getElementById("flowRepresentation").addEventListener("calciteSegmentedControlChange", updateRenderer);
        document.getElementById("trailCap").addEventListener("calciteSegmentedControlChange", updateRenderer);
        document.getElementById("effectsEnabled").addEventListener("calciteCheckboxChange", updateEffect);

        function updateEffect(event) {
            layer.effect = event.target.checked ? "bloom(1.5, 0.5px, 0)" : null;
        }

        function updateRenderer(event) {
            let propName = event.target.id;
            let propValue = event.target.value;
            if (propName && propValue != null) {
                let tempRenderer = layer.renderer.clone();
                tempRenderer[propName] = propValue;
                layer.renderer = tempRenderer;
            }
        }
    </script>
</body>
</html>